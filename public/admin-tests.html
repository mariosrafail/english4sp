<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin Tests</title>
  <link rel="stylesheet" href="/styles.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="/admin-tests-ui.css"/>
  <link rel="icon" href="/favicon.ico"/>
</head>
<body class="tests-bs">
  <div class="wrap testsWrap">
    <div class="card p-3 p-lg-4">
      <div style="margin-bottom:10px" data-embed-hide>
        <a class="badge" href="/admin.html" aria-label="Back to Admin" title="Back to Admin" style="display:inline-flex; align-items:center; justify-content:center; width:46px; height:42px; padding:0;">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" style="width:22px; height:22px;">
            <path d="M14.7 5.3a1 1 0 0 1 0 1.4L10.41 11H20a1 1 0 1 1 0 2h-9.59l4.3 4.3a1 1 0 1 1-1.42 1.4l-6-6a1 1 0 0 1 0-1.4l6-6a1 1 0 0 1 1.41 0Z" fill="currentColor"/>
          </svg>
        </a>
      </div>

      <div class="testsHeader">
        <div class="left" data-embed-hide>
          <h1 class="mb-0">Test Builder</h1>
          <div class="muted small">Create and manage multiple-choice tests per exam period.</div>
        </div>
        <div class="right">
          <div style="min-width:260px;">
            <div class="small muted">Exam period</div>
            <select id="examPeriod" class="form-select form-select-sm mono" aria-label="Select exam period">
              <option value="">Loading...</option>
            </select>
          </div>
          <button id="btnSavePreview" class="btn btn-primary btn-sm" type="button">Save & Preview</button>
        </div>
      </div>

      <div id="testLockBanner" class="alert alert-warning border mt-3" style="display:none;" role="alert">
        <div class="fw-bold">Test is locked</div>
        <div class="small">The exam has already started, so changes are disabled.</div>
      </div>

      <div class="admin-q-tabs admin-tests-top-tabs" role="tablist" aria-label="Test sections">
        <button class="admin-q-tab" type="button" role="tab" aria-selected="true" data-qtab="listening">Listening</button>
        <button class="admin-q-tab" type="button" role="tab" aria-selected="false" data-qtab="reading">Reading</button>
        <button class="admin-q-tab" type="button" role="tab" aria-selected="false" data-qtab="writing">Writing</button>
      </div>

      <div class="testsGrid">
        <div class="testsCol testsColLeft">
          <div class="editorCard">
            <div class="editorTitle">
              <h3 class="mb-0">Add / Edit</h3>
              <div class="small muted">Click a question on the right to edit.</div>
            </div>

            <div id="readingTextEditor" style="margin-top:10px; display:none;">
              <label class="form-label small muted">Reading text block</label>
              <div class="small muted" style="margin-top:-6px;">Tip: wrap any part in <span class="mono">**double asterisks**</span> to make it bold.</div>
              <textarea id="readingText" class="form-control" rows="10" placeholder="Reading text here..."></textarea>
              <div class="d-flex gap-2 mt-2 flex-wrap">
                <button id="btnSaveReadingText" class="btn btn-primary btn-sm" type="button">Save</button>
                <button id="btnClearReadingText" class="btn btn-outline-secondary btn-sm" type="button">Clear</button>
              </div>
            </div>

            <div id="mcqEditor" style="margin-top:10px;">
              <div id="listeningAudioBox" class="alert alert-light border" style="display:none; margin-bottom:10px;">
                <div class="fw-bold">Listening audio (MP3)</div>
                <div class="small text-muted mt-1">Upload an MP3 and the exam will use it for this exam period.</div>
                <div class="d-flex gap-2 align-items-center flex-wrap mt-2">
                  <input id="listeningAudioFile" class="form-control form-control-sm" type="file" accept="audio/mpeg,audio/mp3,.mp3" style="max-width:420px;"/>
                  <button id="btnUploadListeningAudio" class="btn btn-outline-primary btn-sm" type="button">Upload</button>
                </div>
                <div class="small text-muted mt-2" id="listeningAudioStatus"></div>
              </div>

              <label class="form-label small muted">Question</label>
              <textarea id="qText" class="form-control" rows="3" placeholder="Write the question..."></textarea>

              <label class="form-label small muted mt-3">Options</label>
              <div id="optionsBox" style="margin-top:6px;"></div>

              <div class="d-flex gap-2 mt-2 flex-wrap">
                <button id="btnAddOption" class="btn btn-outline-secondary btn-sm" type="button">Add option</button>
                <button id="btnRemoveOption" class="btn btn-outline-secondary btn-sm" type="button">Remove last</button>
              </div>

              <div class="d-flex gap-2 mt-3 flex-wrap">
                <button id="btnAddQuestion" class="btn btn-primary btn-sm" type="button">Save item</button>
                <button id="btnNewQuestion" class="btn btn-outline-secondary btn-sm" type="button">Add new question</button>
                <button id="btnClearQuestion" class="btn btn-outline-secondary btn-sm" type="button">Clear</button>
              </div>
            </div>

            <div id="dragEditor" style="margin-top:10px; display:none;">
              <div class="alert alert-light border">
                <div class="fw-bold">Drag words exercise</div>
                <div class="small text-muted mt-1">This config powers the 3rd page (drag the words) of the test.</div>
                <div class="small text-muted mt-2">
                  Mark the correct gap-words in the text using <span class="mono">**word**</span>. Add extra unused words using
                  <span class="mono">*word1*</span> <span class="mono">*word2*</span>.
                </div>
              </div>

              <label class="form-label small muted">Task 1 title</label>
              <input id="dragTitle" class="form-control" type="text" placeholder="Task 1: Drag the correct words into the gaps."/>

              <label class="form-label small muted">Instructions (shown to candidates)</label>
              <textarea id="dragInstructions" class="form-control" rows="3" placeholder="Write instructions for this task..."></textarea>

              <label class="form-label small muted mt-3">Text (use **word** for gaps)</label>
              <textarea id="dragText" class="form-control" rows="8" placeholder="Rain makes the **streets** shine."></textarea>

              <label class="form-label small muted mt-3">Extra unused words (format: *word1* *word2*)</label>
              <textarea id="dragExtras" class="form-control mono" rows="2" placeholder="*at* *raincoat*"></textarea>

              <div id="dragPreview" class="q mt-3">
                <div class="small muted">Preview will appear here.</div>
              </div>

              <div class="d-flex gap-2 mt-3 flex-wrap">
                <button id="btnSaveDrag" class="btn btn-primary btn-sm" type="button">Save</button>
                <button id="btnResetDrag" class="btn btn-outline-secondary btn-sm" type="button">Reset</button>
              </div>
            </div>

            <div id="writingEditor" style="margin-top:10px; display:none;">
              <label class="form-label small muted">Writing prompt</label>
              <textarea id="writingPrompt" class="form-control" rows="7" placeholder="Write the writing task..."></textarea>
              <div class="d-flex gap-2 mt-2 flex-wrap">
                <button id="btnSaveWriting" class="btn btn-primary btn-sm" type="button">Save</button>
                <button id="btnResetWriting" class="btn btn-outline-secondary btn-sm" type="button">Reset</button>
              </div>
            </div>

            <div id="out" class="small muted mt-3"></div>
          </div>
        </div>

        <div class="testsCol testsColRight">
          <div class="editorCard">
            <div class="editorTitle">
              <h3 class="mb-0">Questions</h3>
              <div class="qListHint">Click a question to edit. Use Up/Down to reorder. Delete removes it (save to persist).</div>
            </div>

            <div id="questionsList" style="margin-top:10px;">
              <div class="admin-q-panel" role="tabpanel" data-qpanel="listening">
                <div id="questionsListening"><div class="muted">Loading...</div></div>
              </div>
              <div class="admin-q-panel" role="tabpanel" data-qpanel="reading" hidden>
                <div id="questionsReading"></div>
              </div>
              <div class="admin-q-panel" role="tabpanel" data-qpanel="writing" hidden>
                <div id="questionsWriting"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/admin-tests.js"></script>
  <script type="module" src="/embed_child.js"></script>
</body>
</html>
