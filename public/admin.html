<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin</title>
  <link rel="stylesheet" href="/styles.css"/>
  <link rel="stylesheet" href="/admin.css"/>
  <link rel="icon" href="/favicon.ico"/>
</head>
<body class="admin-page">
  <div class="wrap">
    <div class="card admin-shell">
      <div class="admin-layout">
        <aside class="admin-sidebar">
          <div class="admin-brand">

            <div class="admin-brand-text">
              <div class="admin-brand-title">Dashboard</div>
              <div class="admin-brand-sub">Admin Panel</div>
            </div>
          </div>

          <nav class="admin-tabs admin-nav" role="tablist" aria-label="Admin sections">
            <button
              class="admin-tab"
              type="button"
              role="tab"
              aria-selected="true"
              tabindex="0"
              data-admin-tab="period"
              id="admin-tab-period"
              aria-controls="admin-panel-period"
            >Exam Period</button>
            <button
              class="admin-tab"
              type="button"
              role="tab"
              aria-selected="false"
              tabindex="-1"
              data-admin-tab="candidates"
              id="admin-tab-candidates"
              aria-controls="admin-panel-candidates"
            >Candidates</button>
            <button
              class="admin-tab"
              type="button"
              role="tab"
              aria-selected="false"
              tabindex="-1"
              data-admin-tab="speaking"
              id="admin-tab-speaking"
              aria-controls="admin-panel-speaking"
            >Speaking Scheduling</button>
            <button
              class="admin-tab"
              type="button"
              role="tab"
              aria-selected="false"
              tabindex="-1"
              data-admin-tab="tests"
              id="admin-tab-tests"
              aria-controls="admin-panel-tests"
            >Test Builder</button>
            <button
              class="admin-tab"
              type="button"
              role="tab"
              aria-selected="false"
              tabindex="-1"
              data-admin-tab="files"
              id="admin-tab-files"
              aria-controls="admin-panel-files"
            >File Manager</button>
            <button
              class="admin-tab admin-tab--danger"
              type="button"
              role="tab"
              aria-selected="false"
              tabindex="-1"
              data-admin-tab="danger"
              id="admin-tab-danger"
              aria-controls="admin-panel-danger"
            >Danger Zone</button>

            <button
              id="btnAdminLogout"
              class="admin-tab admin-tab--danger admin-tab--logout"
              type="button"
              role="button"
              title="Log out"
            >Log out</button>
          </nav>

        </aside>

        <div class="admin-main">
          <main class="admin-tabpanels">
            <section
              class="admin-tabpanel"
              role="tabpanel"
              tabindex="0"
              id="admin-panel-period"
              aria-labelledby="admin-tab-period"
              data-admin-panel="period"
            >
              <div class="admin-section">
                <h2>Exam Period</h2>

                <div class="notice admin-status" id="statusBox">
                  <div class="admin-period-grid">
                    <div class="admin-status-item admin-status-item--period">
                      <div class="muted">Choose exam period</div>
                      <select id="examPeriodSelectTop" class="input mono"></select>
                    </div>
                    <div class="admin-period-actions">
                      <button id="btnCreateExamPeriod" class="btn" type="button">Create</button>
                      <button id="btnDeleteExamPeriod" class="btn" type="button">Delete</button>
                    </div>
                    <div class="admin-status-item">
                      <div class="muted">Server time</div>
                      <div id="serverNow" class="mono admin-mono-value">-</div>
                    </div>
                    <div class="admin-status-item">
                      <div class="muted">Current window</div>
                      <div id="windowLine" class="mono admin-mono-value">-</div>
                    </div>
                  </div>
                </div>

                <div class="admin-period-settings">
                  <div>
                    <label class="label">Opens at (date and time)</label>
                    <input id="openDT" class="input mono" type="datetime-local" step="60"/>
                    <div class="help"><span id="openUtcPreview" class="mono">-</span></div>
                  </div>
                  <div>
                    <label class="label">Duration (minutes)</label>
                    <input id="durationMin" class="input mono" type="number" min="1" step="1" value="60"/>
                  </div>
                  <div class="admin-period-save">
                    <button id="btnSaveExamPeriod" class="btn primary admin-main-btn" type="button">Save Exam Period</button>
                    <div id="cfgOut" class="help admin-out"></div>
                  </div>
                </div>
              </div>
            </section>

            <section
              class="admin-tabpanel"
              role="tabpanel"
              tabindex="0"
              id="admin-panel-candidates"
              aria-labelledby="admin-tab-candidates"
              data-admin-panel="candidates"
              hidden
            >
              <div class="admin-section">
                <h2>Candidates</h2>

                <div class="admin-candidates-grid">
                  <div class="admin-subsection">
                    <h3 class="admin-subtitle-h">Import Candidates (Excel)</h3>
                    <div id="dropZone" class="dropzone" tabindex="0">
                      <div class="admin-drop-title">Drag the file here</div>
                      <div class="muted">or</div>
                      <button id="btnBrowse" class="btn admin-inline-btn" type="button">Browse</button>
                      <input id="fileInput" type="file" accept=".xlsx,.xls" style="display:none;"/>
                      <div id="fileName" class="mono admin-file-name">No file selected</div>
                      <div class="help">Expected columns: Name, email, Country code</div>
                    </div>

                    <button id="btnImport" class="btn primary admin-main-btn" type="button">Generate Links and File</button>
                    <div id="out" class="muted admin-out"></div>
                  </div>

                  <div class="admin-subsection">
                    <h3 class="admin-subtitle-h">Add Single Candidate</h3>
                    <label class="label">Name</label>
                    <input id="singleName" class="input" type="text" placeholder="Candidate name"/>

                    <label class="label">Email <span class="bad">*</span></label>
                    <input id="singleEmail" class="input mono" type="email" placeholder="name@example.com"/>

                    <label class="label">Country code</label>
                    <select id="singleCountry" class="input mono">
                      <option value="">Select country code</option>
                    </select>

                    <button id="btnCreateSingle" class="btn admin-main-btn" type="button">Create Candidate Link</button>
                    <div id="singleOut" class="muted admin-out"></div>
                  </div>
                </div>

                <div class="admin-embed-block admin-embed-block--flush">
                  <h3 class="admin-subtitle-h">Manage Candidates</h3>
                  <iframe
                    id="adminCandidatesFrame"
                    class="admin-embed-frame admin-embed-frame--flush"
                    title="Candidates"
                    src="/candidates.html?embed=1"
                    loading="lazy"
                    referrerpolicy="same-origin"
                  ></iframe>
                </div>
              </div>
            </section>

            <section
              class="admin-tabpanel"
              role="tabpanel"
              tabindex="0"
              id="admin-panel-speaking"
              aria-labelledby="admin-tab-speaking"
              data-admin-panel="speaking"
              hidden
            >
              <div class="admin-section">
                <h2>Speaking Scheduling</h2>
                <div class="admin-embed-block admin-embed-block--flush">
                  <iframe
                    id="adminSpeakingFrame"
                    class="admin-embed-frame admin-embed-frame--flush"
                    title="Speaking Scheduling"
                    src="/speaking-scheduling.html?embed=1"
                    loading="lazy"
                    referrerpolicy="same-origin"
                  ></iframe>
                </div>
              </div>
            </section>

            <section
              class="admin-tabpanel"
              role="tabpanel"
              tabindex="0"
              id="admin-panel-tests"
              aria-labelledby="admin-tab-tests"
              data-admin-panel="tests"
              hidden
            >
              <div class="admin-section">
                <h2>Tests</h2>
                <div class="admin-embed-block admin-embed-block--flush">
                  <iframe
                    id="adminTestsFrame"
                    class="admin-embed-frame admin-embed-frame--flush"
                    title="Tests"
                    src="/admin-tests.html?embed=1"
                    loading="lazy"
                    referrerpolicy="same-origin"
                  ></iframe>
                </div>
              </div>
            </section>

            <section
              class="admin-tabpanel"
              role="tabpanel"
              tabindex="0"
              id="admin-panel-files"
              aria-labelledby="admin-tab-files"
              data-admin-panel="files"
              hidden
            >
              <div class="admin-section">
                <h2>File Manager</h2>
                <div class="admin-embed-block admin-embed-block--flush">
                  <iframe
                    id="adminFilesFrame"
                    class="admin-embed-frame admin-embed-frame--flush"
                    title="File Manager"
                    src="/admin-files.html?embed=1"
                    loading="lazy"
                    referrerpolicy="same-origin"
                  ></iframe>
                </div>
              </div>
            </section>

            <section
              class="admin-tabpanel"
              role="tabpanel"
              tabindex="0"
              id="admin-panel-danger"
              aria-labelledby="admin-tab-danger"
              data-admin-panel="danger"
              hidden
            >
              <div class="admin-section admin-danger">
                <h2>Danger Zone</h2>
                <p class="muted">
                  This will permanently delete all <b>candidate</b> data (grades, names, sessions).
                </p>

                <button id="btnDeleteAllData" type="button" class="admin-danger-btn">Delete all data</button>
                <div id="deleteAllOut" class="help admin-out"></div>
              </div>
            </section>
          </main>
        </div>
      </div>
    </div>
  </div>

  <div id="importPeriodOverlay" class="admin-modal-overlay" style="display:none;">
    <div class="card admin-modal-card">
      <h2 class="admin-modal-title">Choose Exam Period</h2>
      <p class="muted admin-modal-subtitle">Select where imported candidates should be placed.</p>
      <label class="label" for="importPeriodSelect">Exam period</label>
      <select id="importPeriodSelect" class="input mono"></select>
      <div class="admin-modal-actions">
        <button id="btnImportPeriodCancel" class="btn" type="button">Cancel</button>
        <button id="btnImportPeriodConfirm" class="btn primary" type="button">Continue</button>
      </div>
    </div>
  </div>

  <div id="adminBusyOverlay" class="adminBusyOverlay" style="display:none;" aria-live="polite" aria-busy="true">
    <div class="adminBusyCard">
      <div class="adminBusySpinner" aria-hidden="true"></div>
      <div id="adminBusyText" class="adminBusyText">Processing. Don't close this page. Please wait...</div>
      <div class="adminBusyBarWrap" aria-hidden="true">
        <div class="adminBusyBar">
          <div id="adminBusyBarFill" class="adminBusyBarFill" style="width:0%"></div>
        </div>
        <div id="adminBusyPct" class="adminBusyPct">0%</div>
      </div>
    </div>
  </div>

  <script type="module" src="/admin.js"></script>
  <script type="module" src="/admin_tabs.js"></script>
  <script type="module" src="/embed_parent.js"></script>
</body>
</html>
